<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jadwal Rapat Hari Ini</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0d1b2a;
      color: white;
    }
    .header {
      text-align: center;
      padding: 20px 10px 10px;
    }
    .header h1 {
      margin: 0;
      font-size: 36px;
    }
    .header p {
      margin: 5px 0;
      font-size: 18px;
    }
    .schedule {
      display: flex;
      justify-content: space-around;
      padding: 20px;
    }
    .room {
      background-color: #1b263b;
      padding: 10px;
      border-radius: 10px;
      width: 20%;
    }
    .room h2 {
      font-size: 18px;
      text-align: center;
      margin-bottom: 10px;
    }
    .event {
      background-color: #1e90ff;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      color: white;
    }
    .event.ongoing {
      background-color: #2ecc71;
    }
    .time {
      font-weight: bold;
    }
    .more {
      text-align: center;
      color: #888;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>JADWAL RAPAT HARI INI</h1>
    <p id="tanggal-hari-ini"></p>
  </div>
  <div class="schedule" id="jadwal-ruang">
    <!-- Jadwal akan diisi oleh JS -->
  </div>
  <script>
    // Tampilkan tanggal hari ini
    const bulanIndo = [
      "Januari", "Februari", "Maret", "April", "Mei", "Juni",
      "Juli", "Agustus", "September", "Oktober", "November", "Desember"
    ];
    const hariIndo = [
      "Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"
    ];
    const now = new Date();
    document.getElementById('tanggal-hari-ini').textContent =
      hariIndo[now.getDay()] + ', ' + now.getDate() + ' ' + bulanIndo[now.getMonth()] + ' ' + now.getFullYear();

    // Ambil data jadwal dari endpoint (gunakan /api/jadwal-rapat, backend ambil dari rapat.json)
    async function loadJadwal() {
      const res = await fetch('/api/jadwal-rapat');
      const ruangList = [
        'Ruang Growth', 'Ruang Harmony', 'Ruang Kopiah', 'Ruang Internasional'
      ];
      let data = [];
      if (res.ok) data = await res.json();
      // Filter hanya hari ini
      const todayStr = now.toISOString().slice(0, 10);
      data = data.filter(r => r.tanggal === todayStr);

      // Kelompokkan per ruang
      const ruangMap = {};
      ruangList.forEach(r => ruangMap[r] = []);
      data.forEach(r => {
        if (ruangMap[r.ruang]) ruangMap[r.ruang].push(r);
      });

      // Render
      const scheduleDiv = document.getElementById('jadwal-ruang');
      scheduleDiv.innerHTML = '';
      ruangList.forEach(ruang => {
        const events = ruangMap[ruang] || [];
        let html = `<div class="room"><h2>${ruang}</h2>`;
        if (!events.length) {
          html += `<div class="event"></div><div class="event"></div><div class="event"></div><div class="more">...</div>`;
        } else {
          // Sort by jam mulai
          events.sort((a, b) => (a.jam || '').localeCompare(b.jam || ''));
          events.forEach(ev => {
            // Cek apakah rapat sedang berlangsung
            let isOngoing = false;
            if (ev.jam && ev.jam_selesai) {
              const jamMulai = ev.jam;
              const jamSelesai = ev.jam_selesai;
              const nowTime = now.toTimeString().slice(0,5);
              isOngoing = (jamMulai <= nowTime && nowTime < jamSelesai);
            }
            html += `<div class="event${isOngoing ? ' ongoing' : ''}" style="background-color:${isOngoing ? '#2ecc71' : '#1e90ff'};">
              <div class="time">${ev.jam || '-'}${ev.jam_selesai ? ' â€“ ' + ev.jam_selesai : ''}</div>
              <div>${ev.agenda || '-'}</div>
              <div style="font-size:13px;color:#fff;opacity:0.8;">PIC: ${ev.pic_name || '-'}</div>
            </div>`;
          });
          // Tambah slot kosong jika kurang dari 3 event
          for (let i = events.length; i < 3; i++) html += `<div class="event"></div>`;
          html += `<div class="more">...</div>`;
        }
        html += `</div>`;
        scheduleDiv.innerHTML += html;
      });
    }
    loadJadwal();
    setInterval(loadJadwal, 1000);
  </script>
</body>
</html>
