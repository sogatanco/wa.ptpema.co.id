<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jadwal Rapat Hari Ini</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0d1b2a;
      color: white;
    }
    .header {
      text-align: center;
      padding: 20px 10px 10px;
    }
    .header h1 {
      margin: 0;
      font-size: 36px;
    }
    .header p {
      margin: 5px 0;
      font-size: 18px;
    }
    .schedule {
      display: flex;
      justify-content: space-around;
      padding: 20px;
    }
    .room {
      background-color: #1b263b;
      padding: 10px;
      border-radius: 10px;
      width: 20%;
    }
    .room h2 {
      font-size: 18px;
      text-align: center;
      margin-bottom: 10px;
    }
    .event {
      background-color: #1e90ff;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      color: white;
    }
    .event.ongoing {
      background-color: #2ecc71;
    }
    .time {
      font-weight: bold;
    }
    .more {
      text-align: center;
      color: #888;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>JADWAL RAPAT HARI INI</h1>
    <p>Senin, 23 Juni 2025</p>
  </div>
  <div class="schedule">
    <div class="room">
      <h2>Ruang Growth</h2>
      <!-- Jadwal diisi oleh JS -->
      <div id="jadwal-growth"></div>
      <div class="more">...</div>
    </div>
    <div class="room">
      <h2>Ruang Harmony</h2>
      <div id="jadwal-harmony"></div>
      <div class="more">...</div>
    </div>
    <div class="room">
      <h2>Ruang Kopiah</h2>
      <div id="jadwal-kopiah"></div>
      <div class="more">...</div>
    </div>
    <div class="room">
      <h2>Ruang Internasional</h2>
      <div id="jadwal-internasional"></div>
      <div class="more">...</div>
    </div>
  </div>
  <script>
    // Helper untuk pad 0
    function pad(num) { return num.toString().padStart(2, '0'); }
    // Helper waktu sekarang (HH:mm)
    function nowTime() {
      const d = new Date();
      return pad(d.getHours()) + ':' + pad(d.getMinutes());
    }

    // Ambil data dari API, bukan data dummy
    const ruangList = [
      "Ruang Growth", "Ruang Harmony", "Ruang Kopiah", "Ruang Internasional"
    ];

    async function renderJadwal() {
      const now = nowTime();
      let data = [];
      try {
        const res = await fetch('http://62.72.56.65:3000/api/jadwal-rapat');
        if (res.ok) data = await res.json();
      } catch {}
      // Filter hanya hari ini
      const today = new Date();
      const todayStr = today.toISOString().slice(0, 10);
      data = Array.isArray(data) ? data.filter(r => r.tanggal === todayStr) : [];

      // Kelompokkan per ruang
      const ruangMap = {};
      ruangList.forEach(r => ruangMap[r] = []);
      data.forEach(r => {
        // Pastikan nama ruang cocok persis (case sensitive)
        if (ruangMap[r.ruang]) ruangMap[r.ruang].push(r);
      });

      ruangList.forEach(ruang => {
        const events = ruangMap[ruang] || [];
        let html = '';
        // Urutkan berdasarkan jam mulai
        events.sort((a, b) => (a.jam || '').localeCompare(b.jam || ''));
        events.forEach(ev => {
          let bg = "#1e90ff";
          // Cek apakah rapat sedang berlangsung
          if (ev.jam && ev.jam_selesai && now >= ev.jam && now < ev.jam_selesai) {
            bg = "#2ecc71";
          }
          html += `<div class="event" style="background-color:${bg};">
            <div class="time">${ev.jam || '-'} â€“ ${ev.jam_selesai || '-'}</div>
            <div>${ev.agenda || '-'}</div>
            <div style="font-size:13px;color:#fff;opacity:0.8;">PIC: ${ev.pic_name || '-'}</div>
          </div>`;
        });
        // Tambah slot kosong jika kurang dari 3 event
        for (let i = events.length; i < 3; i++) html += `<div class="event"></div>`;
        document.getElementById('jadwal-' + ruang.toLowerCase().replace(' ', '-')).innerHTML = html;
      });
    }
    renderJadwal();
    setInterval(renderJadwal, 1000);
  </script>
</body>
</html>
